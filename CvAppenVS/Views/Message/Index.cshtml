@using CvAppen.Web.DTOs
@model IEnumerable<MessageDto>

@{
	ViewBag.Title = "Inkorg";
}

@if (TempData["Error"] != null)
{
	<div class="alert alert-danger">
		@TempData["Error"]
	</div>
}

<h2>@ViewBag.Message</h2>

<div class="chat-container">
	@foreach (var message in Model)
	{
		<div class="chat-message @(message.IsRead ? "read" : "unread")">
			<div class="chat-header">
				<strong>@message.SenderName</strong>
				<span class="chat-time">
					@message.SentAt.ToString("yyyy-MM-dd HH:mm")
				</span>
			</div>

			<div class="chat-text">
				@message.Text
			</div>
			<td>
				<form asp-action="Remove"
					  asp-controller="Message"
					  asp-route-id="@message.Id"
					  method="get"
					  style="display:inline;">
					<button type="submit" class="btn erase"> 🗑 </button>
				</form>
			</td>

			@if (!message.IsRead)
			{
				<form asp-action="MarkAsRead"
					  asp-controller="Message"
					  method="post"
					  style="display:inline;">

					<input type="hidden" name="id" value="@message.Id" />

					<label>
						<input type="checkbox"
							   onchange="this.form.submit()" />
						Markera som läst
					</label>
				</form>
			}
			else
			{
				<span class="text-muted">Läst</span>
			}
		</div>
	}
</div>

