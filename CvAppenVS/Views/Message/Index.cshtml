@using CvAppen.Web.DTOs
@model IEnumerable<MessageDto>

@{
	ViewBag.Title = "Inkorg";
}

@if (TempData["Error"] != null)
{
	<div class="alert alert-danger">
		@TempData["Error"]
	</div>
}
@if (TempData["Success"] != null)
{
	<div class="alert alert-success alert-dismissible fade show" role="alert">
		@TempData["Success"]
		<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
	</div>
}

<div class="d-flex justify-content-between align-items-center mb-3">
	<h2>@ViewBag.Message</h2>
	<a asp-action="Add" class="btn btn-dark rounded-pill">
		<i class="bi bi-pencil-square"></i> Nytt meddelande
	</a>
</div>
<div class="btn-group mb-3">
	<a asp-action="Index" class="btn btn-outline-dark active">Inkorg</a>
	<a asp-action="Sent" class="btn btn-outline-dark">Skickat</a>
</div>

<div class="chat-container">
	@foreach (var message in Model)
	{
		<div class="chat-message @(message.IsRead ? "read" : "unread")">
			<div class="chat-header">
				<strong>@message.SenderName</strong>
				<span class="chat-time">
					@message.SentAt.ToString("yyyy-MM-dd HH:mm")
				</span>
			</div>

			<div class="chat-text">
				@message.Text
			</div>
			<div class="chat-actions mt-2">
				@if (!string.IsNullOrEmpty(message.FromUserId))
				{
					<a asp-action="Add" asp-route-toUserId="@message.FromUserId"
					   class="btn btn-sm btn-outline-dark rounded-pill me-2">
						Svara
					</a>
				}
			
				<form asp-action="Remove"
					  asp-controller="Message"
					  asp-route-id="@message.Id"
					  method="get"
					  style="display:inline;">
					<button type="submit" class="btn erase"> 🗑 </button>
				</form>
			

			@if (!message.IsRead)
			{
				<form asp-action="MarkAsRead"
					  asp-controller="Message"
					  method="post"
					  style="display:inline;">

					<input type="hidden" name="id" value="@message.Id" />

					<label>
						<input type="checkbox"
							   onchange="this.form.submit()" />	
						Markera som läst
					</label>
				</form>
			}
			else
			{
				<span class="text-muted">Läst</span>
			}
		</div>
		</div>
	}
</div>

